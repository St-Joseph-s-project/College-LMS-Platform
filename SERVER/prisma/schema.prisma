generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/tenant-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model action_logs {
  id          Int       @id @default(autoincrement())
  user_id     Int
  action      String    @db.VarChar
  target_type String?   @db.VarChar
  target_id   Int?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
}

model batches {
  id         Int    @id @default(autoincrement())
  batch_year String @unique @db.VarChar
}

model bus_stops {
  id       Int                       @id @default(autoincrement())
  name     String?                   @db.VarChar(255)
  location Unsupported("geography")?
}

model categories {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model colleges {
  id           Int     @id @default(autoincrement())
  college_code Int?    @unique
  name         String? @db.VarChar
}

model departments {
  id              Int     @id @default(autoincrement())
  name            String? @db.VarChar
  department_code String? @db.VarChar
  college_id      Int?
}

model login_logs {
  id         Int       @id @default(autoincrement())
  user_id    Int
  ip_address String?   @db.VarChar
  status     String?   @db.VarChar
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model mcq_attempt_answers {
  test_attempt_id     Int
  mcq_question_id     Int
  selected_option_ids Int[]    @default([])
  marks_awarded       Decimal? @db.Decimal(10, 2)

  @@id([test_attempt_id, mcq_question_id])
}

model mcq_options {
  id              Int      @id @default(autoincrement())
  mcq_question_id Int
  option_text     String   @db.VarChar
  is_correct      Boolean? @default(false)
}

model mcq_question_tags {
  mcq_question_id Int
  tag_id          Int

  @@id([mcq_question_id, tag_id])
}

model mcq_questions {
  id            Int                     @id @default(autoincrement())
  question      String
  question_type mcq_question_type_enum?
  max_marks     Decimal?                @default(1) @db.Decimal(10, 2)
  created_by    Int?
  created_at    DateTime?               @default(now()) @db.Timestamp(6)
  category_id   Int?
}

model modules {
  id          Int      @id @default(autoincrement())
  parent_id   Int?
  name        String?  @db.VarChar
  order_index Int?
  is_leaf     Boolean?
  created_by  Int?
}

model permissions {
  id         Int     @id @default(autoincrement())
  permission String? @db.VarChar
}

model placement {
  id             Int     @id @default(autoincrement())
  placement_name String? @unique @db.VarChar
  department_id  Int?
}

model problem_tags {
  problem_id Int
  tag_id     Int

  @@id([problem_id, tag_id])
}

model problems {
  id            Int              @id @default(autoincrement())
  module_id     Int?
  title         String?          @db.VarChar
  description   String?
  difficulty    difficulty_enum?
  order_index   Int?
  created_by    Int?
  is_published  Boolean?
  category_id   Int?
  test_problems test_problems[]
}

model programming_language {
  id       Int     @id @default(autoincrement())
  language String? @db.VarChar
}

model role_permissions {
  id         Int  @id @default(autoincrement())
  role       Int?
  permission Int?
}

model roles {
  id   Int     @id @default(autoincrement())
  role String? @db.VarChar
}

model student_platform_profiles {
  id         Int     @id @default(autoincrement())
  student_id Int     @unique
  leetcode   String? @db.VarChar
  hackerrank String? @db.VarChar
  codeforces String? @db.VarChar
  atcoder    String? @db.VarChar
  skillrack  String? @db.VarChar
  codechef   String? @db.VarChar
}

model student_profiles {
  id        Int  @id @default(autoincrement())
  user_id   Int  @unique
  batch_id  Int?
  mentor_id Int?
}

model submissions {
  id              Int                     @id @default(autoincrement())
  user_id         Int?
  problem_id      Int?
  language_id     Int?
  ip_address      String?                 @db.VarChar
  code            String?
  status          submission_status_enum?
  runtime         Int?
  memory          Int?
  test_attempt_id Int?
  created_at      DateTime?               @default(now()) @db.Timestamp(6)
}

model tags {
  id          Int    @id @default(autoincrement())
  name        String @unique @db.VarChar
  category_id Int?
}

model test_attempt_malpractice {
  id         Int       @id @default(autoincrement())
  attempt_id Int?
  type       String?   @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model test_attempts {
  id                  Int                       @id @default(autoincrement())
  test_id             Int?
  user_id             Int?
  start_time          DateTime?                 @db.Timestamp(6)
  end_time            DateTime?                 @db.Timestamp(6)
  count               Int?
  status              test_attempt_status_enum?
  total_marks         Decimal?                  @db.Decimal(10, 2)
  max_marks           Decimal?                  @db.Decimal(10, 2)
  navigation_override Int?                      @default(0)
}

model test_mcq_questions {
  test_id         Int
  mcq_question_id Int
  order_index     Int? @default(0)

  @@id([test_id, mcq_question_id])
}

model test_problems {
  test_id    Int
  problem_id Int
  problems   problems @relation(fields: [problem_id], references: [id], onDelete: Cascade)
  tests      tests    @relation(fields: [test_id], references: [id], onDelete: Cascade)

  @@id([test_id, problem_id])
}

model test_target_batches {
  test_id  Int
  batch_id Int

  @@id([test_id, batch_id])
}

model test_target_departments {
  test_id       Int
  department_id Int

  @@id([test_id, department_id])
}

model test_target_placements {
  test_id      Int
  placement_id Int

  @@id([test_id, placement_id])
}

model testcases {
  id         Int      @id @default(autoincrement())
  problem_id Int?
  input      String?
  output     String?
  is_sample  Boolean?
}

model tests {
  id                Int               @id @default(autoincrement())
  name              String?           @db.VarChar
  batch_id          Int?
  college_id        Int?
  start_time        DateTime?         @db.Timestamp(6)
  end_time          DateTime?         @db.Timestamp(6)
  status            test_status_enum?
  created_by        Int?
  test_type         test_type_enum?
  results_published Boolean?          @default(false)
  max_navigations   Int?              @default(3)
  duration_minutes  Int?              @default(60)
  test_problems     test_problems[]
}

model user_permissions {
  user_id       Int
  permission_id Int

  @@id([user_id, permission_id])
}

model users {
  id               Int              @id @default(autoincrement())
  name             String?          @db.VarChar
  email            String           @unique @db.VarChar
  password         String?          @db.VarChar
  phone            String?          @db.VarChar
  registration_no  String?          @db.VarChar
  role_id          Int?
  college_id       Int?
  department_id    Int?
  placement_id     Int?
  roll_number      String?          @db.VarChar
  staff_id         String?          @db.VarChar
  created_at       DateTime?        @default(now()) @db.Timestamp(6)
  last_login       DateTime?        @db.Timestamp(6)
  is_super_admin   Boolean?         @default(false)
  coins            Int?             @default(0)
  streak           Int?             @default(0)
  last_solved_date DateTime?        @db.Timestamp(6)
  github_id        String?          @db.VarChar
  github_username  String?          @db.VarChar
  user_purchases   user_purchases[]
  users_rewards    users_rewards[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model store_items {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  description    String?
  cost           Int
  image_url      String?
  type           String?          @default("STORE_ITEM") @db.VarChar(50)
  is_active      Boolean?         @default(true)
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  updated_at     DateTime?        @default(now()) @db.Timestamp(6)
  user_purchases user_purchases[]
}

model user_purchases {
  id           Int         @id @default(autoincrement())
  user_id      Int
  item_id      Int
  purchased_at DateTime?   @default(now()) @db.Timestamp(6)
  status       String?     @default("COMPLETED") @db.VarChar(50)
  store_items  store_items @relation(fields: [item_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        users       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model rewards {
  id            Int             @id @default(autoincrement())
  title         String
  description   String
  coins         Int
  image_url     String
  image_key     String
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @default(now()) @updatedAt @db.Timestamp(6)
  is_deleted    Boolean?        @default(false)
  users_rewards users_rewards[]
}

model users_rewards {
  id             Int                 @id @default(autoincrement())
  user_id        Int
  reward_id      Int
  status         reward_status_enum? @default(PENDING)
  ordered_date   DateTime?           @default(now()) @db.Timestamp(6)
  delivered_date DateTime?           @db.Timestamp(6)
  rewards        rewards             @relation(fields: [reward_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reward")
  users          users               @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user")
}

model lms_course {
  id                                                                       Int                          @id @default(autoincrement())
  name                                                                     String                       @db.VarChar(100)
  description                                                              String?
  is_published                                                             Boolean?                     @default(false)
  created_at                                                               DateTime?                    @default(now()) @db.Timestamp(6)
  lms_course_dependency_lms_course_dependency_course_idTolms_course        lms_course_dependency[]      @relation("lms_course_dependency_course_idTolms_course")
  lms_course_dependency_lms_course_dependency_parent_course_idTolms_course lms_course_dependency[]      @relation("lms_course_dependency_parent_course_idTolms_course")
  lms_module                                                               lms_module[]
  lms_roadmap_course_mapping                                               lms_roadmap_course_mapping[]
  lms_user_course_view                                                     lms_user_course_view[]
  lms_user_module_view                                                     lms_user_module_view[]
  lms_user_submodule_view                                                  lms_user_submodule_view[]

  @@index([is_published], map: "idx_lms_course_published")
}

model lms_module {
  id                      Int                       @id @default(autoincrement())
  course_id               Int
  order_index             Int
  name                    String                    @db.VarChar(100)
  description             String?
  is_published            Boolean?                  @default(false)
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  lms_course              lms_course                @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_submodule           lms_submodule[]
  lms_user_module_view    lms_user_module_view[]
  lms_user_submodule_view lms_user_submodule_view[]

  @@index([course_id], map: "idx_lms_module_course")
  @@index([course_id, order_index], map: "idx_lms_module_order")
  @@index([is_published], map: "idx_lms_module_published")
}

model lms_question_options {
  id                     Int                    @id @default(autoincrement())
  question_id            Int
  order_index            Int
  option_text            String
  is_answer              Boolean?               @default(false)
  created_at             DateTime?              @default(now()) @db.Timestamp(6)
  lms_submodule_question lms_submodule_question @relation(fields: [question_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([is_answer], map: "idx_lms_option_answer")
  @@index([question_id], map: "idx_lms_option_question")
}

model lms_roadmap {
  id                         Int                          @id @default(autoincrement())
  name                       String                       @db.VarChar(100)
  description                String?
  is_published               Boolean?                     @default(false)
  created_at                 DateTime?                    @default(now()) @db.Timestamp(6)
  lms_roadmap_course_mapping lms_roadmap_course_mapping[]
  lms_user_roadmap_view      lms_user_roadmap_view[]

  @@index([is_published], map: "idx_lms_roadmap_published")
}

model lms_roadmap_course_mapping {
  id          Int         @id @default(autoincrement())
  roadmap_id  Int
  course_id   Int
  order_index Int
  created_at  DateTime?   @default(now()) @db.Timestamp(6)
  lms_course  lms_course  @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_roadmap lms_roadmap @relation(fields: [roadmap_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([roadmap_id, course_id])
  @@index([course_id], map: "idx_lms_rcm_course")
  @@index([roadmap_id, order_index], map: "idx_lms_rcm_order")
  @@index([roadmap_id], map: "idx_lms_rcm_roadmap")
}

model lms_submodule {
  id                      Int                       @id @default(autoincrement())
  module_id               Int
  name                    String                    @db.VarChar(100)
  description             String?
  video_url               String?
  content                 String?
  is_test                 Boolean?                  @default(false)
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  lms_module              lms_module                @relation(fields: [module_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_submodule_question  lms_submodule_question[]
  lms_user_submodule_view lms_user_submodule_view[]

  @@index([module_id], map: "idx_lms_submodule_module")
  @@index([is_test], map: "idx_lms_submodule_test")
}

model lms_submodule_question {
  id                   Int                    @id @default(autoincrement())
  submodule_id         Int
  question             String
  order_index          Int
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  lms_question_options lms_question_options[]
  lms_submodule        lms_submodule          @relation(fields: [submodule_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([submodule_id, order_index], map: "idx_lms_question_order")
  @@index([submodule_id], map: "idx_lms_question_submodule")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lms_user_course_view {
  id           Int        @id @default(autoincrement())
  user_id      Int
  course_id    Int
  status       String?    @db.VarChar(20)
  started_at   DateTime?  @db.Timestamp(6)
  completed_at DateTime?  @db.Timestamp(6)
  lms_course   lms_course @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, course_id])
  @@index([course_id], map: "idx_lms_ucv_course")
  @@index([status], map: "idx_lms_ucv_status")
  @@index([user_id], map: "idx_lms_ucv_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lms_user_module_view {
  id           Int        @id @default(autoincrement())
  user_id      Int
  module_id    Int
  course_id    Int
  status       String?    @db.VarChar(20)
  started_at   DateTime?  @db.Timestamp(6)
  completed_at DateTime?  @db.Timestamp(6)
  lms_course   lms_course @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_module   lms_module @relation(fields: [module_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, module_id])
  @@index([module_id], map: "idx_lms_umv_module")
  @@index([status], map: "idx_lms_umv_status")
  @@index([user_id], map: "idx_lms_umv_user")
}

model lms_user_roadmap_view {
  id          Int         @id @default(autoincrement())
  user_id     Int
  roadmap_id  Int
  created_at  DateTime?   @default(now()) @db.Timestamp(6)
  lms_roadmap lms_roadmap @relation(fields: [roadmap_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, roadmap_id])
  @@index([roadmap_id], map: "idx_lms_urv_roadmap")
  @@index([user_id], map: "idx_lms_urv_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lms_course_dependency {
  id                                                            Int        @id @default(autoincrement())
  course_id                                                     Int
  parent_course_id                                              Int
  lms_course_lms_course_dependency_course_idTolms_course        lms_course @relation("lms_course_dependency_course_idTolms_course", fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_course_lms_course_dependency_parent_course_idTolms_course lms_course @relation("lms_course_dependency_parent_course_idTolms_course", fields: [parent_course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([course_id, parent_course_id])
  @@index([course_id], map: "idx_lms_dep_course")
  @@index([parent_course_id], map: "idx_lms_dep_parent")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lms_user_submodule_view {
  id            Int           @id @default(autoincrement())
  user_id       Int
  submodule_id  Int
  module_id     Int
  course_id     Int
  status        String?       @db.VarChar(20)
  started_at    DateTime?     @db.Timestamp(6)
  completed_at  DateTime?     @db.Timestamp(6)
  lms_course    lms_course    @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_module    lms_module    @relation(fields: [module_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lms_submodule lms_submodule @relation(fields: [submodule_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, submodule_id])
  @@index([status], map: "idx_lms_usv_status")
  @@index([submodule_id], map: "idx_lms_usv_submodule")
  @@index([user_id], map: "idx_lms_usv_user")
}

enum difficulty_enum {
  EASY
  MEDIUM
  HARD
}

enum test_status_enum {
  NOT_SCHEDULED
  SCHEDULED
  LIVE
  COMPLETED
  CANCELLED
}

enum test_attempt_status_enum {
  STARTED
  COMPLETED
}

enum submission_status_enum {
  NOT_ATTEMPTED
  SOLVED
  WRONG_ANSWER
}

enum test_type_enum {
  CODING
  MCQ
}

enum mcq_question_type_enum {
  SINGLE_CHOICE
  MULTIPLE_CHOICE
}

enum login_status_enum {
  SUCCESS
  FAILURE
}

enum reward_status_enum {
  PENDING
  APPROVED
  REJECTED
  DELIVERED
}
